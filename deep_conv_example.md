# （深度）转化模型的样本方案

在信息流类的互联网产品中，存在着各种各样的`转化`现象。比如用户点击了文章题目进入详情页，再比如用户对带货视频产生了购买行为，亦或是用户后续会花比较长的时间来看一本小说或是一部电视剧。这些转化行为的发生是带有很强的随机性的，但其中又有明显的规律，这种规律主要来人类行为中的四个特点：

1. 高热：指有一些优质的item或者更容易诱导用户产生某些转化行为的item，无论曝光给哪种用户，往往都会有比较高的转化率。比如标题党会诱导用户点击标题，又比如故意让评论对对联的帖子会天然评论率就会很高，这样的看起来像是作弊的例子不胜枚举。但也有一些转化类型，如果一个item能做到高热，那么基本能够认为它更为优质，比如停留时长，或是item留存。
2. 个性化：指不同的用户群体会定义不同的高热转化标准。通过观察可以发现一些用户在体育类item上的某些转化率明显比他们在历史类item上的这种转化率要高很多。这可以对应所谓`长期兴趣`。
3. 用户惯性：
4. 位置偏倚：

面对转化行为的建模，我们必须要充分理解其随机性。同样是用基于embedding和MLP的监督学习模型，用于分类色情文本的分类器模型基本可以认为其groundtruth是确定不变的，并且几乎所有的信号都是可以被系统采集到并且可以作为训练特征的，但用于排序item的ctr模型，用户的groundtruth却受各种因素影响，其中绝大部分是系统不可能捕捉到的。

一个`转化`的格式如下所示

## 转化与样本的关系

```protobuf
message Conv {
    ConvType conv_type = 1;
    int64 conv_time = 2;
    float conv_value = 3;
    repeated int64 conv_item_id = 4;

    repeated Attr attr = 101;
}
```

转化`Conv`会作为一个样本`Example`的一个重要成员属性。所谓样本拼接程序`deep_conv`，就是为`Example`填充不同的`Conv`属性，这些`Conv`属性在后续的使用主要有两种：

1. 直接提供给训练器`trainer`程序，并被训练脚本转化为label。
2. 被更深层的`deep_conv`使用，产出`更深度`的转化样本。

在上述的转化定义中，`Conv`需要记录至少四种信息

一个训练样本格式为：

```protobuf
message Meta {
    int64 user_id = 1;
    int64 item_id = 2;
    // ...
    repeated Conv conv = 20;
}
message Example {
    Meta meta = 1;
    repeated float label = 2;
    repeated int64 feature_id = 3;
    repeated Embedding embedding = 4;
}
```

每个训练样本包括若干个Meta

## 对比不同的item_type

在Meta的定义中就有item_type，表示的被推荐内容的类型。这个类型的划分是根据

## 转化结果作为特征

从本节开始，我们讨论将转化样本以特征的形式供给给转化模型的方法。